<meta_metadata_repository name="flickrPhotoPost"
  package="ecologylab.bigsemantics.generated.library.creativeWork.blogPost">

  <meta_metadata name="flickr_photo" extends="post" parser="xpath" comment="A Flickr image post page">
    
    <selector url_regex_fragment="https://www.flickr.com/photos/[^/]*/[0-9]" domain="flickr.com" />
    
    <example_url url="http://www.flickr.com/photos/kali-kold/8345182714/" />
    <example_url url="http://www.flickr.com/photos/sobrido/8137315867/" />
    
    <scalar name="title" scalar_type="String" navigates_to="location">
      <xpath>//meta[@property='og:title']/@content</xpath>
    </scalar>
    <scalar name="description" ignore_in_term_vector="true" scalar_type="String">
      <xpath>//meta[@property='og:description']/@content</xpath>
    </scalar>
    <scalar name="image_location" hide="true" scalar_type="ParsedURL">
      <xpath>//meta[@property='og:image']/@content</xpath>
    </scalar>
    <scalar name="year">
      <xpath>(//span[@class='date-taken-label'])[1]/text()</xpath>
      <replace pattern=".*," to="" />
    </scalar>
    <scalar name="views" scalar_type="String">
      <xpath>(//span[@class='view-count-label'])[1]/text()</xpath>
    </scalar>

    <composite name="place" type="rich_document">
      <xpath>(//a[@class='location-name-link'])[1]</xpath>
      <scalar name="title">
        <xpath>./text()</xpath>
      </scalar>
      <scalar name="location" hide="true">
        <xpath>./@href</xpath>
      </scalar>
    </composite>

	<!-- This doesn't display right in MICE -->
    <composite name="geo_location" type="gis_location">
      <scalar name="latitude">
        <xpath>(//a[@class='static-maps'])[1]/@href</xpath>
        <replace pattern=".*fLat=" to="" />
        <replace pattern="&amp;.*" to="" />
      </scalar>
      <scalar name="longitude">
        <xpath>(//a[@class='static-maps'])[1]/@href</xpath>
        <replace pattern=".*fLon=" to="" />
        <replace pattern="&amp;.*" to="" />        
      </scalar>
    </composite>

    <collection name="tags" child_type="flickr_tag">
      <xpath>//ul[@class='tags-list']/li/a[2]</xpath>
      <scalar name="title">
        <xpath>./text()</xpath>
      </scalar>
      <scalar name="location">
        <xpath>./@href</xpath>
      </scalar>
    </collection>

    <collection name="authors" label="authors">
      <xpath>.</xpath>
      <scalar name="location">
        <xpath>//meta[@property='flickr_photos:by']/@content</xpath>
      </scalar><!--TBD 
				ad author page... -->
      <scalar name="title">
        <xpath>(//a[@class='owner-name truncate'])[1]/text()</xpath>
      </scalar>
    </collection>

    <semantic_actions>
      <get_field name="image_location" />
      <get_field name="title" />
      <create_and_visualize_img_surrogate>
        <arg value="image_location" name="image_purl" />
        <arg value="title" name="caption" />
      </create_and_visualize_img_surrogate>
    </semantic_actions>
    
  </meta_metadata>
</meta_metadata_repository>