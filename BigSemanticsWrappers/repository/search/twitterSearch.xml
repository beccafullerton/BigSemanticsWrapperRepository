<meta_metadata_repository name="twitterSearch"
  package="ecologylab.bigsemantics.generated.library.search">
  
   <meta_metadata name="twitter_search_results" type="search" parser="xpath" no_cache="true">
    <selector url_stripped="https://twitter.com/search" />
    <selector url_path_tree="https://twitter.com/hashtag/" />
    <example_url url="https://twitter.com/search?q=%23socialinnovation" />
		
		<!-- def_var doesn't currently seem to be working in js metadata extraction -->
		<!--<def_var name="search" type="node" xpath="//h2[@id='content-main-heading']/strong"/>-->

    <scalar name="title" context_node="search" hide_label="true">
      <xpath>//h2[@id='content-main-heading']/strong</xpath>
      <regex_op regex="Twitter / Search - " replace="" />
    </scalar>
    <scalar name="location" context_node="search">
      <xpath>//h2[@id='content-main-heading']/strong</xpath>
      <regex_op regex="^" replace="https://twitter.com/search?q=" />
    </scalar>

	<scalar name="description" hide_label="true" />
	
    <generic_type_var name="SR" arg="post" />

    <collection name="search_results" label="tweets" child_type="tweet" 
      label_at="top" child_show_expanded_always="true" child_use_value_as_label="twitter_microblog.photo">
      <xpath>//ol[@id='stream-items-id']/li//div[@class='content']</xpath>

      <composite name="twitter_microblog" type="twitter_microblog" hide_label="true">
        <xpath>./div[@class='stream-item-header']/a</xpath>
        <style is_child_metadata="true" hide="true" />
        <scalar name="title">
          <xpath>./strong</xpath>
        </scalar>
        <scalar name="location">
          <xpath>./span/b</xpath>
          <regex_op regex="^" replace="https://twitter.com/" />
        </scalar>
		    	<!-- <scalar name="username" xpath="./span" /> -->
		    	
		    	<!-- <collection name="tweeters" child_type="tweeter" xpath="." hide_label="true"> -->
        <composite name="photo" label="image">
          <xpath>./img</xpath>
          <scalar name="location" always_show="true">
            <xpath>./@src</xpath>
          </scalar>
        </composite>
				<!-- </collection>			    			    -->
      </composite>

      <scalar name="description" hide_label="true" extract_as_html="true">
        <xpath>./p[@class='js-tweet-text tweet-text']</xpath>
      </scalar>
      <scalar name="post_date" hide_label="true">
        <xpath>.//small[@class='time']//span</xpath>
      </scalar>
      <scalar name="id" concatenates_to="post_date" hide_label="true">
        <xpath>.//a[@class='details with-icn js-details']/@href</xpath>
        <regex_op regex="[^/]+$" />
      </scalar>

    </collection>
  </meta_metadata>
</meta_metadata_repository>