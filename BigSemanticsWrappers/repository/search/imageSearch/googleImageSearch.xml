<meta_metadata_repository xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  name="googleImageSearch" package="ecologylab.bigsemantics.generated.library.search"
  default_user_agent_name="chrome_2">

	<meta_metadata name="google_image_search" extends="image_search"
	comment="Google image search." parser="xpath" extract_with="service">
	
	    <selector url_regex="https?://www.google.co(m|m?\.\w\w)/search\?.*" domain="google.com">
	      <param name="tbm" value="isch" />
	    </selector>
	    <selector url_regex="https?://www.google.co(m|m?\.\w\w)/webhp\?.*" domain="google.com">
	      <param name="tbm" value="isch" />
	    </selector>
	    <selector url_regex="https?://www.google.co(m|m?\.\w\w)/images\?.*" domain="google.com">
	      <param name="tbm" value="isch" />
	    </selector>
	    <example_url url="https://www.google.com/search?tbm=isch&amp;hl=en&amp;q=watergate" />
	    <example_url url="http://www.google.com/search?hl=en&amp;tbm=isch&amp;q=earth" />
	
	    <filter_location>
	      <replace pattern="//www.google.co(m|m?\.\w\w)/webhp" to="//www.google.com/search" />
	      <override_params />
	      <set_param name="btnG" value="search" />
	      <set_param name="site" value="imghp" />
	      <set_param name="tbm" value="isch" />
	      <set_param name="gbv" value="1" />
	      <set_param name="hl" value="en" only_when_not_set="true" />
	      <strip_params_but>
	        <name>q</name>
	        <name>tbm</name>
	        <name>btnG</name>
	        <name>site</name>
	        <name>gbv</name>
	        <name>hl</name>
	      </strip_params_but>
	    </filter_location>
	
    <collection name="search_results">
      <xpath>//div[@class='rg_di rg_el ivg-i']</xpath>
      <xpath>//table[@class='images_table']//td</xpath>

      <scalar name ="title">
        <xpath>.//span</xpath>
        <xpath>.</xpath>
      </scalar>
	
		<scalar name="location">
			<xpath>./a[not(@class)]/@href</xpath>
		  <xpath>./a/@href</xpath> 
		  <get_param name="imgrefurl" />
		</scalar>
		
		   <collection name="main_images">
		     <xpath>.//a</xpath>
		     <scalar name="location">
		       <xpath>./img[not(@class)]/@src</xpath>
		       <xpath>./@href</xpath>
		       <get_param name="imgurl" />
		     </scalar>
		   </collection> 
	  
	   <scalar name="thumb_width" label="thumbnail width">
	      <xpath>//img/@width</xpath>
	      <append value=" px" /> 
	    </scalar>
	    
	    <scalar name="thumb_height" label="thumbnail height">
	      <xpath>//img/@height</xpath>
	      <append value=" px" />
	    </scalar>
	  
	  
	</collection>
	
	<collection name="related_searches">
	  <xpath>//a[@class='rg_fbl']</xpath>
	  <xpath>//p[@class='_Bmc']</xpath>
	  
	  <scalar name="title">
	    <xpath>.//div[@class='_ucd']</xpath>
	    <xpath>./a</xpath>
	  </scalar>
	  
	  <scalar name="location">
	    <xpath>./@href</xpath>
	    <xpath>./a/@href</xpath>
	  </scalar>
	  
	  <collection name="main_images">
	      <xpath>.//img[@class='rg_i']</xpath>
	      
	      <scalar name="location">
	        <xpath>./@src</xpath>
	      </scalar>
	  </collection>  
	
	 </collection>
	 
	</meta_metadata>

	<meta_metadata name="google_image_search_result" extends="image_search_result" comment="Google image search result."
	    parser="xpath" extract_with="service">
	
	    <selector url_regex="https?://www.google.co(m|m?\.\w\w)/imgres\?imgurl=.*" domain="google.com">
	    </selector>    
	
	    <scalar name ="title">
	      <xpath>//span[@class='irc_pt' and @dir='ltr']</xpath>
	    </scalar>
	 
	    <scalar name="description" label="description">
	      <xpath>//span[@class='irc_su' and @dir='ltr']</xpath>
	    </scalar>
	   
	    <scalar name="site_link" label="source"  >
	      <xpath>//a[@class='irc_vpl irc_but i3599']/@href</xpath>
	    </scalar>
	    
	    <scalar name="thumb_width" label="thumbnail width">
	      <xpath>//img/@width</xpath>
	      <append value=" px" /> 
	    </scalar>
	    
	    <scalar name="thumb_height" label="thumbnail height">
	      <xpath>//img/@height</xpath>
	      <append value=" px" />
	    </scalar>
	 
	    <collection name="main_images">
	        <xpath>./a</xpath>
	        <get_param name="imgurl" />
	        <scalar name="location">
	          <xpath>./img/@src</xpath>
	        </scalar>
	      </collection>  
	     
	</meta_metadata> 

</meta_metadata_repository>